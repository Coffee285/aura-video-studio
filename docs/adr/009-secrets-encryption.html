<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>009. Secrets Encryption Strategy | Aura Video Studio </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="009. Secrets Encryption Strategy | Aura Video Studio ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Coffee285/aura-video-studio/blob/main/docs/adr/009-secrets-encryption.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="Aura Video Studio">
            Aura Video Studio
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="009-secrets-encryption-strategy">009. Secrets Encryption Strategy</h1>

<p>Date: 2024-03-01
Status: Accepted</p>
<h2 id="context">Context</h2>
<p>Aura Video Studio handles sensitive user data including:</p>
<ul>
<li>OpenAI API keys</li>
<li>ElevenLabs API keys</li>
<li>Other third-party service credentials</li>
<li>User preferences and settings</li>
</ul>
<p>These secrets must be stored securely on the user's machine. We needed to determine:</p>
<ol>
<li>Where to store secrets</li>
<li>How to encrypt them at rest</li>
<li>How to handle decryption</li>
<li>What to do with secrets in logs and diagnostics</li>
</ol>
<p>Key requirements:</p>
<ul>
<li>Secrets must be encrypted at rest</li>
<li>Encryption should use OS-provided mechanisms when possible</li>
<li>No secrets should appear in logs or diagnostics</li>
<li>Simple API for developers to use</li>
<li>Cross-platform support (Windows primary, Linux/macOS secondary)</li>
</ul>
<h2 id="decision">Decision</h2>
<p>We will use <strong>platform-specific encryption</strong> with a common abstraction:</p>
<p><strong>Windows (Primary Platform):</strong></p>
<ul>
<li>Use Windows Data Protection API (DPAPI)</li>
<li>User scope encryption (not machine scope)</li>
<li>Secrets accessible only to the current user</li>
<li>Stored in <code>%LOCALAPPDATA%\AuraVideoStudio\secrets.dat</code></li>
</ul>
<p><strong>Linux/macOS (Secondary Platforms):</strong></p>
<ul>
<li>Use libsecret (Linux) / Keychain (macOS) where available</li>
<li>Fallback to encrypted file with user-specific key</li>
<li>Stored in <code>~/.local/share/AuraVideoStudio/secrets.dat</code></li>
</ul>
<p><strong>Common Features:</strong></p>
<ul>
<li>Abstraction layer: <code>ISecretsManager</code> interface</li>
<li>Automatic redaction in logs using <code>[REDACTED]</code> placeholder</li>
<li>Privacy mode for support bundles (redact all PII)</li>
<li>Encryption status indicator in UI</li>
</ul>
<h2 id="consequences">Consequences</h2>
<h3 id="positive-consequences">Positive Consequences</h3>
<ul>
<li><strong>Platform-native security</strong>: Leverages OS security features</li>
<li><strong>User-scoped</strong>: Secrets isolated to individual users</li>
<li><strong>No master password</strong>: Users don't need to remember another password</li>
<li><strong>Automatic encryption</strong>: Transparent to application code</li>
<li><strong>Log safety</strong>: Automatic redaction prevents leaks</li>
<li><strong>Diagnostic safety</strong>: Support bundles don't contain secrets</li>
<li><strong>Simple API</strong>: Developers use <code>GetSecret()</code> and <code>SetSecret()</code> without crypto knowledge</li>
</ul>
<h3 id="negative-consequences">Negative Consequences</h3>
<ul>
<li><strong>Platform-specific code</strong>: Different implementations per OS</li>
<li><strong>No cross-device sync</strong>: Secrets don't follow user across machines</li>
<li><strong>User access required</strong>: Can't access secrets when running as service</li>
<li><strong>Recovery difficulty</strong>: If user profile corrupted, secrets lost</li>
<li><strong>No sharing</strong>: Secrets can't be shared between users on same machine</li>
</ul>
<h2 id="alternatives-considered">Alternatives Considered</h2>
<h3 id="alternative-1-plain-text-storage">Alternative 1: Plain Text Storage</h3>
<p><strong>Description:</strong> Store API keys in plain text configuration files.</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Simple to implement</li>
<li>Easy to debug</li>
<li>No encryption overhead</li>
<li>Cross-platform identical</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li><strong>Major security risk</strong>: Keys accessible to anyone with file access</li>
<li>Keys visible in backups</li>
<li>Risk of accidental commit to version control</li>
<li>Violates security best practices</li>
</ul>
<p><strong>Why Rejected:</strong> Unacceptable security risk. API keys are valuable and could be abused if stolen. Professional software must encrypt sensitive data.</p>
<h3 id="alternative-2-custom-encryption-with-master-password">Alternative 2: Custom Encryption with Master Password</h3>
<p><strong>Description:</strong> Encrypt secrets with AES using user-provided master password.</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Full control over encryption</li>
<li>Cross-platform identical code</li>
<li>Password-protected access</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Users must remember another password</li>
<li>Password management complexity (reset, recovery)</li>
<li>Must implement secure key derivation (PBKDF2/Argon2)</li>
<li>Must handle password storage securely</li>
<li>More attack surface (custom crypto is risky)</li>
</ul>
<p><strong>Why Rejected:</strong> Adds friction for users (another password) and increases implementation complexity. Platform-native security is more robust and audited.</p>
<h3 id="alternative-3-cloud-based-secret-storage">Alternative 3: Cloud-Based Secret Storage</h3>
<p><strong>Description:</strong> Store encrypted secrets in cloud service (e.g., AWS Secrets Manager, Azure Key Vault).</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Centralized management</li>
<li>Cross-device synchronization</li>
<li>Professional-grade security</li>
<li>Audit logging</li>
<li>Easy rotation</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Requires internet connection</li>
<li>Requires cloud account</li>
<li>Monthly costs</li>
<li>Privacy concerns (secrets leave user's machine)</li>
<li>Overkill for desktop application</li>
<li>Vendor lock-in</li>
</ul>
<p><strong>Why Rejected:</strong> Inappropriate for desktop application. Users expect local, offline operation. Cloud dependency would reduce usability and add costs.</p>
<h3 id="alternative-4-environment-variables">Alternative 4: Environment Variables</h3>
<p><strong>Description:</strong> Store secrets in environment variables, not files.</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Common in server environments</li>
<li>No file storage needed</li>
<li>Process isolation</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Not persistent (lost on restart)</li>
<li>Visible in process listings</li>
<li>Awkward for desktop applications</li>
<li>No encryption at rest</li>
<li>Difficult for non-technical users</li>
</ul>
<p><strong>Why Rejected:</strong> Environment variables are appropriate for servers but not desktop applications. Users expect settings to persist and be manageable through UI.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/standard/security/how-to-use-data-protection">Windows Data Protection API (DPAPI)</a></li>
<li><a href="https://wiki.gnome.org/Projects/Libsecret">Linux libsecret</a></li>
<li><a href="https://developer.apple.com/documentation/security/keychain_services">macOS Keychain Services</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html">OWASP: Cryptographic Storage Cheat Sheet</a></li>
</ul>
<h2 id="notes">Notes</h2>
<p>This decision prioritizes security without sacrificing usability. Platform-native encryption provides strong security with zero user friction.</p>
<p>Implementation details:</p>
<pre><code class="lang-csharp">// Usage in application code
string apiKey = await secretsManager.GetSecretAsync(&quot;openai-api-key&quot;);

// Automatic redaction in logs
logger.LogInformation(&quot;API key loaded: {Key}&quot;, apiKey); 
// Output: &quot;API key loaded: [REDACTED]&quot;
</code></pre>
<p>The redaction system prevents accidental logging of secrets:</p>
<ul>
<li>Redacts known secret names in log messages</li>
<li>Redacts values that look like API keys (regex patterns)</li>
<li>Privacy mode redacts all PII in diagnostic bundles</li>
</ul>
<p>This approach ensures Aura Video Studio can securely handle API keys while maintaining ease of use and providing excellent debugging capabilities without security risks.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Coffee285/aura-video-studio/blob/main/docs/adr/009-secrets-encryption.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Â© 2025 Aura Video Studio. Documentation built with DocFX.
        </div>
      </div>
    </footer>
  </body>
</html>

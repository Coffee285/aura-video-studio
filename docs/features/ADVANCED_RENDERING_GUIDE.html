<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Advanced Video Rendering Features - Implementation Guide | Aura Video Studio </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Advanced Video Rendering Features - Implementation Guide | Aura Video Studio ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Coffee285/aura-video-studio/blob/main/docs/features/ADVANCED_RENDERING_GUIDE.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="Aura Video Studio">
            Aura Video Studio
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="advanced-video-rendering-features---implementation-guide">Advanced Video Rendering Features - Implementation Guide</h1>

<h2 id="overview">Overview</h2>
<p>This guide documents the advanced video rendering features implemented for PR #18, including complex transitions, effects, audio processing, GPU monitoring, and real-time rendering analytics.</p>
<h2 id="1-video-transitions-and-effects">1. Video Transitions and Effects</h2>
<h3 id="crossfade-transition">Crossfade Transition</h3>
<p>Smooth transition between two video clips with gradual opacity change.</p>
<pre><code class="lang-csharp">var builder = new FFmpegCommandBuilder()
    .AddInput(&quot;clip1.mp4&quot;)
    .AddInput(&quot;clip2.mp4&quot;)
    .AddCrossfadeTransition(duration: 1.5, offset: 5.0)
    .SetOutput(&quot;output.mp4&quot;);
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>durationSeconds</code>: Duration of the crossfade (default: 1.0 seconds)</li>
<li><code>offset</code>: Time offset where transition starts</li>
</ul>
<h3 id="wipe-transition">Wipe Transition</h3>
<p>Directional wipe transition between clips.</p>
<pre><code class="lang-csharp">builder.AddWipeTransition(
    durationSeconds: 1.0, 
    offset: 5.0, 
    direction: &quot;right&quot; // Options: left, right, up, down
);
</code></pre>
<h3 id="dissolve-transition">Dissolve Transition</h3>
<p>Classic dissolve effect between clips.</p>
<pre><code class="lang-csharp">builder.AddDissolveTransition(durationSeconds: 2.0, offset: 10.0);
</code></pre>
<h2 id="2-ken-burns-effect">2. Ken Burns Effect</h2>
<p>Dynamic zoom and pan effect for still images.</p>
<pre><code class="lang-csharp">builder.AddKenBurnsEffect(
    durationSeconds: 5.0,
    zoomStart: 1.0,      // Starting zoom (1.0 = no zoom)
    zoomEnd: 1.3,        // Ending zoom (1.3 = 130%)
    panX: 0.1,           // Horizontal pan (-1.0 to 1.0)
    panY: -0.1           // Vertical pan (-1.0 to 1.0)
);
</code></pre>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Bring life to static images</li>
<li>Create motion in photo slideshows</li>
<li>Highlight specific areas of images</li>
</ul>
<h2 id="3-picture-in-picture-pip">3. Picture-in-Picture (PiP)</h2>
<p>Overlay one video on top of another.</p>
<pre><code class="lang-csharp">builder.AddInput(&quot;main_video.mp4&quot;)
       .AddInput(&quot;overlay_video.mp4&quot;)
       .AddPictureInPicture(
           overlayInputIndex: 1,
           x: &quot;W-w-10&quot;,          // 10px from right edge
           y: &quot;H-h-10&quot;,          // 10px from bottom edge
           scale: 0.25           // 25% of original size
       );
</code></pre>
<p><strong>Common Positions:</strong></p>
<ul>
<li>Bottom-right: <code>x: &quot;W-w-10&quot;</code>, <code>y: &quot;H-h-10&quot;</code></li>
<li>Top-right: <code>x: &quot;W-w-10&quot;</code>, <code>y: &quot;10&quot;</code></li>
<li>Bottom-left: <code>x: &quot;10&quot;</code>, <code>y: &quot;H-h-10&quot;</code></li>
<li>Center: <code>x: &quot;(W-w)/2&quot;</code>, <code>y: &quot;(H-h)/2&quot;</code></li>
</ul>
<h2 id="4-text-overlays">4. Text Overlays</h2>
<h3 id="static-text-overlay">Static Text Overlay</h3>
<pre><code class="lang-csharp">builder.AddTextOverlay(
    text: &quot;Hello World&quot;,
    fontFile: &quot;/path/to/font.ttf&quot;,  // Optional
    fontSize: 48,
    x: &quot;(w-text_w)/2&quot;,              // Center horizontally
    y: &quot;(h-text_h)/2&quot;,              // Center vertically
    fontColor: &quot;white&quot;,
    boxColor: &quot;black@0.5&quot;           // Optional background
);
</code></pre>
<h3 id="animated-text-with-fade">Animated Text with Fade</h3>
<pre><code class="lang-csharp">builder.AddAnimatedTextOverlay(
    text: &quot;Fade In and Out&quot;,
    startTime: 2.0,           // Start at 2 seconds
    duration: 5.0,            // Display for 5 seconds
    fadeInDuration: 0.5,      // Fade in over 0.5 seconds
    fadeOutDuration: 0.5,     // Fade out over 0.5 seconds
    fontSize: 48
);
</code></pre>
<h3 id="sliding-text-animation">Sliding Text Animation</h3>
<pre><code class="lang-csharp">builder.AddSlidingTextOverlay(
    text: &quot;Breaking News&quot;,
    startTime: 1.0,
    duration: 3.0,
    direction: &quot;left&quot;,  // Options: left, right, up, down
    fontSize: 48
);
</code></pre>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Lower thirds</li>
<li>Titles and credits</li>
<li>Subtitles</li>
<li>Breaking news tickers</li>
</ul>
<h2 id="5-audio-processing">5. Audio Processing</h2>
<h3 id="audio-mixing">Audio Mixing</h3>
<p>Combine multiple audio sources with custom volume levels.</p>
<pre><code class="lang-csharp">builder.AddInput(&quot;voice.mp3&quot;)
       .AddInput(&quot;music.mp3&quot;)
       .AddInput(&quot;sfx.mp3&quot;)
       .AddAudioMix(
           inputCount: 3,
           weights: new[] { 1.0, 0.3, 0.5 } // Voice full, music 30%, SFX 50%
       );
</code></pre>
<h3 id="audio-ducking">Audio Ducking</h3>
<p>Automatically lower background audio when foreground audio is present (perfect for voice-over with background music).</p>
<pre><code class="lang-csharp">builder.AddInput(&quot;voice.mp3&quot;)      // Foreground
       .AddInput(&quot;music.mp3&quot;)      // Background
       .AddAudioDucking(
           foregroundIndex: 0,
           backgroundIndex: 1,
           threshold: -20,         // Trigger at -20dB
           ratio: 4,               // Reduce by 4:1
           attack: 20,             // Attack time in ms
           release: 250            // Release time in ms
       );
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>threshold</code>: Level at which ducking activates (-40 to 0 dB)</li>
<li><code>ratio</code>: Reduction ratio (1 to 20, higher = more reduction)</li>
<li><code>attack</code>: How quickly ducking applies (milliseconds)</li>
<li><code>release</code>: How quickly ducking releases (milliseconds)</li>
</ul>
<h2 id="6-watermark">6. Watermark</h2>
<p>Add a logo or watermark to video.</p>
<pre><code class="lang-csharp">builder.AddWatermark(
    watermarkPath: &quot;/path/to/logo.png&quot;,
    position: &quot;bottom-right&quot;,  // top-left, top-right, bottom-left, bottom-right, center
    opacity: 0.7,              // 0.0 to 1.0
    margin: 10                 // Margin from edges in pixels
);
</code></pre>
<h2 id="7-two-pass-encoding">7. Two-Pass Encoding</h2>
<p>For better quality, especially with constrained bitrates.</p>
<pre><code class="lang-csharp">// First pass
var pass1 = new FFmpegCommandBuilder()
    .AddInput(&quot;input.mp4&quot;)
    .SetOutput(&quot;output.mp4&quot;)
    .SetVideoCodec(&quot;libx264&quot;)
    .SetVideoBitrate(5000)
    .SetTwoPassEncoding(&quot;/tmp/passlog&quot;, pass: 1)
    .Build();

// Second pass
var pass2 = new FFmpegCommandBuilder()
    .AddInput(&quot;input.mp4&quot;)
    .SetOutput(&quot;output.mp4&quot;)
    .SetVideoCodec(&quot;libx264&quot;)
    .SetVideoBitrate(5000)
    .SetTwoPassEncoding(&quot;/tmp/passlog&quot;, pass: 2)
    .Build();

// Execute both passes sequentially
</code></pre>
<p><strong>Benefits:</strong></p>
<ul>
<li>Better quality at same bitrate</li>
<li>More accurate bitrate targeting</li>
<li>Recommended for final delivery</li>
</ul>
<h2 id="8-chapter-markers">8. Chapter Markers</h2>
<p>Add chapters for navigation in long-form content.</p>
<pre><code class="lang-csharp">var chapters = new List&lt;(TimeSpan, string)&gt;
{
    (TimeSpan.FromSeconds(0), &quot;Introduction&quot;),
    (TimeSpan.FromMinutes(2), &quot;Setup Instructions&quot;),
    (TimeSpan.FromMinutes(10), &quot;Advanced Features&quot;),
    (TimeSpan.FromMinutes(25), &quot;Conclusion&quot;)
};

builder.AddChapterMarkers(chapters);
</code></pre>
<h2 id="9-gpu-monitoring-and-memory-management">9. GPU Monitoring and Memory Management</h2>
<h3 id="detect-gpu-capabilities-with-memory-info">Detect GPU Capabilities with Memory Info</h3>
<pre><code class="lang-csharp">var encoder = new HardwareEncoder(logger, &quot;ffmpeg&quot;);
var capabilities = await encoder.DetectHardwareCapabilitiesAsync();

if (capabilities.HasNVENC &amp;&amp; capabilities.GpuMemory != null)
{
    Console.WriteLine($&quot;GPU: {capabilities.GpuMemory.GpuName}&quot;);
    Console.WriteLine($&quot;Total Memory: {capabilities.GpuMemory.TotalMemoryBytes / 1024.0 / 1024.0 / 1024.0:F2} GB&quot;);
    Console.WriteLine($&quot;Free Memory: {capabilities.GpuMemory.FreeMemoryBytes / 1024.0 / 1024.0 / 1024.0:F2} GB&quot;);
    Console.WriteLine($&quot;Usage: {capabilities.GpuMemory.UsagePercentage:F1}%&quot;);
}
</code></pre>
<h3 id="monitor-gpu-utilization">Monitor GPU Utilization</h3>
<pre><code class="lang-csharp">var utilization = await encoder.GetGpuUtilizationAsync();

if (utilization != null)
{
    Console.WriteLine($&quot;GPU Usage: {utilization.GpuUsagePercent:F1}%&quot;);
    Console.WriteLine($&quot;Memory Usage: {utilization.MemoryUsagePercent:F1}%&quot;);
    Console.WriteLine($&quot;Encoder Usage: {utilization.EncoderUsagePercent:F1}%&quot;);
    Console.WriteLine($&quot;Temperature: {utilization.TemperatureCelsius:F1}°C&quot;);
}
</code></pre>
<h3 id="check-gpu-memory-availability">Check GPU Memory Availability</h3>
<pre><code class="lang-csharp">// Estimate required memory for encoding
var required = encoder.EstimateRequiredGpuMemory(
    width: 3840,
    height: 2160,
    fps: 30,
    durationSeconds: 600
);

// Check if GPU has sufficient memory
var hasSufficient = await encoder.HasSufficientGpuMemoryAsync(required);

if (!hasSufficient)
{
    Console.WriteLine(&quot;Insufficient GPU memory, falling back to CPU encoding&quot;);
}
</code></pre>
<h2 id="10-real-time-rendering-monitoring">10. Real-Time Rendering Monitoring</h2>
<h3 id="setup-render-monitor">Setup Render Monitor</h3>
<pre><code class="lang-csharp">var monitor = new RenderMonitor(logger, hardwareEncoder);

// Start monitoring when FFmpeg process starts
monitor.StartMonitoring(ffmpegProcess, totalFrames: 9000);

// Parse FFmpeg output lines
foreach (var line in ffmpegOutput)
{
    monitor.ParseProgressLine(line, totalFrames: 9000);
    monitor.ParseErrorLine(line);
    
    // Display current stats
    var stats = monitor.CurrentStats;
    if (stats != null)
    {
        Console.WriteLine($&quot;Progress: {stats.ProgressPercent:F1}%&quot;);
        Console.WriteLine($&quot;FPS: {stats.CurrentFps:F1} (avg: {stats.AverageFps:F1})&quot;);
        Console.WriteLine($&quot;Bitrate: {stats.CurrentBitrate:F1} kbits/s&quot;);
        Console.WriteLine($&quot;Speed: {stats.Speed:F2}x&quot;);
        Console.WriteLine($&quot;ETA: {stats.Estimated}&quot;);
        Console.WriteLine($&quot;CPU: {stats.CpuUsagePercent:F1}%&quot;);
        Console.WriteLine($&quot;Memory: {stats.MemoryUsageMb:F1} MB&quot;);
        
        if (stats.GpuStats != null)
        {
            Console.WriteLine($&quot;GPU: {stats.GpuStats.GpuUsagePercent:F1}%&quot;);
            Console.WriteLine($&quot;GPU Encoder: {stats.GpuStats.EncoderUsagePercent:F1}%&quot;);
        }
    }
}

// Stop monitoring when done
await monitor.StopMonitoringAsync();
</code></pre>
<h3 id="error-detection-and-health-monitoring">Error Detection and Health Monitoring</h3>
<pre><code class="lang-csharp">// Check for errors
if (monitor.Errors.Count &gt; 0)
{
    foreach (var error in monitor.Errors)
    {
        Console.WriteLine($&quot;[{error.Timestamp}] {error.Message}&quot;);
        Console.WriteLine($&quot;  Recoverable: {error.IsRecoverable}&quot;);
    }
}

// Check if there are critical errors
if (monitor.HasCriticalErrors())
{
    Console.WriteLine(&quot;Critical errors detected, aborting render&quot;);
}

// Get overall health status
var health = monitor.GetHealthStatus();
Console.WriteLine($&quot;Health: {health}&quot;); // Healthy, Degraded, Warning, Critical, Unknown
</code></pre>
<h3 id="generate-preview-frames">Generate Preview Frames</h3>
<pre><code class="lang-csharp">// Generate preview at specific timestamp
var preview = await monitor.GeneratePreviewFrameAsync(
    inputVideo: &quot;/path/to/video.mp4&quot;,
    timestamp: TimeSpan.FromSeconds(30),
    outputPath: &quot;/tmp/preview.jpg&quot;,
    width: 640,
    height: 360
);

if (preview != null)
{
    Console.WriteLine($&quot;Preview saved: {preview.FilePath}&quot;);
}
</code></pre>
<h2 id="11-complete-example-professional-video-with-all-features">11. Complete Example: Professional Video with All Features</h2>
<pre><code class="lang-csharp">var builder = new FFmpegCommandBuilder()
    // Add main video and overlay
    .AddInput(&quot;main_video.mp4&quot;)
    .AddInput(&quot;intro_clip.mp4&quot;)
    .AddInput(&quot;pip_video.mp4&quot;)
    .AddInput(&quot;voice.mp3&quot;)
    .AddInput(&quot;background_music.mp3&quot;)
    
    // Add crossfade between intro and main
    .AddCrossfadeTransition(1.5, 5.0)
    
    // Add picture-in-picture
    .AddPictureInPicture(2, &quot;W-w-10&quot;, &quot;H-h-10&quot;, 0.25)
    
    // Add animated title
    .AddAnimatedTextOverlay(&quot;My Video Title&quot;, 1.0, 3.0, 0.5, 0.5, 72)
    
    // Add lower third subtitle
    .AddTextOverlay(&quot;by John Doe&quot;, null, 36, &quot;(w-text_w)/2&quot;, &quot;h-100&quot;, &quot;white&quot;, &quot;black@0.7&quot;)
    
    // Add watermark
    .AddWatermark(&quot;/path/to/logo.png&quot;, &quot;bottom-right&quot;, 0.6, 15)
    
    // Mix voice and music with ducking
    .AddAudioDucking(3, 4, -20, 4, 20, 250)
    
    // Add chapters
    .AddChapterMarkers(new[]
    {
        (TimeSpan.Zero, &quot;Introduction&quot;),
        (TimeSpan.FromMinutes(2), &quot;Main Content&quot;),
        (TimeSpan.FromMinutes(10), &quot;Conclusion&quot;)
    })
    
    // Set output parameters
    .SetOutput(&quot;final_video.mp4&quot;)
    .SetVideoCodec(&quot;libx264&quot;)
    .SetVideoBitrate(8000)
    .SetAudioCodec(&quot;aac&quot;)
    .SetAudioBitrate(256)
    .SetResolution(1920, 1080)
    .SetFrameRate(30)
    .SetPreset(&quot;medium&quot;)
    .SetCRF(23)
    .SetMaxBitrate(10000)
    .SetBufferSize(20000);

var command = builder.Build();
</code></pre>
<h2 id="performance-considerations">Performance Considerations</h2>
<h3 id="gpu-memory-management">GPU Memory Management</h3>
<ul>
<li>1080p video: ~300-500 MB GPU memory</li>
<li>4K video: ~1-2 GB GPU memory</li>
<li>Always check available memory before encoding</li>
<li>Monitor temperature and throttling</li>
</ul>
<h3 id="rendering-speed">Rendering Speed</h3>
<ul>
<li><strong>Hardware encoding</strong>: 5-10x faster than CPU
<ul>
<li>NVENC: Best quality/speed balance</li>
<li>AMF: Good for AMD GPUs</li>
<li>QuickSync: Good for Intel CPUs</li>
</ul>
</li>
<li><strong>Two-pass encoding</strong>: ~2x slower but better quality</li>
<li><strong>Complex filters</strong>: May reduce speed by 20-50%</li>
</ul>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li><strong>Use hardware acceleration when available</strong></li>
<li><strong>Monitor GPU memory to prevent OOM</strong></li>
<li><strong>Use two-pass for final delivery, single-pass for previews</strong></li>
<li><strong>Add error detection and recovery</strong></li>
<li><strong>Generate preview frames for quality checks</strong></li>
<li><strong>Monitor health status during long renders</strong></li>
<li><strong>Use appropriate presets for target platforms</strong></li>
</ol>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="gpu-memory-issues">GPU Memory Issues</h3>
<p>If you encounter GPU memory errors:</p>
<ol>
<li>Check available memory: <code>GetGpuMemoryInfoAsync()</code></li>
<li>Reduce resolution or complexity</li>
<li>Fall back to CPU encoding</li>
<li>Process in smaller segments</li>
</ol>
<h3 id="slow-rendering">Slow Rendering</h3>
<p>If rendering is slower than expected:</p>
<ol>
<li>Check GPU utilization (should be &gt;80% when using hardware encoding)</li>
<li>Verify hardware encoder is actually being used</li>
<li>Reduce filter complexity</li>
<li>Check CPU/memory bottlenecks</li>
</ol>
<h3 id="quality-issues">Quality Issues</h3>
<p>If output quality is poor:</p>
<ol>
<li>Use two-pass encoding</li>
<li>Increase bitrate</li>
<li>Lower CRF value (lower = better quality)</li>
<li>Use slower preset (veryslow, slower, slow)</li>
<li>Check source quality</li>
</ol>
<h2 id="api-reference">API Reference</h2>
<p>See the following files for complete API documentation:</p>
<ul>
<li><code>FFmpegCommandBuilder.cs</code> - All rendering commands</li>
<li><code>HardwareEncoder.cs</code> - GPU detection and monitoring</li>
<li><code>RenderMonitor.cs</code> - Real-time progress and error tracking</li>
<li><code>RenderPresets.cs</code> - Platform-specific presets</li>
</ul>
<h2 id="examples-repository">Examples Repository</h2>
<p>For complete working examples, see:</p>
<ul>
<li><code>Aura.Tests/Services/FFmpeg/FFmpegCommandBuilderAdvancedFeaturesTests.cs</code></li>
<li><code>Aura.Tests/Services/Render/HardwareEncoderMonitoringTests.cs</code></li>
<li><code>Aura.Tests/Services/Render/RenderMonitorTests.cs</code></li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Coffee285/aura-video-studio/blob/main/docs/features/ADVANCED_RENDERING_GUIDE.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © 2025 Aura Video Studio. Documentation built with DocFX.
        </div>
      </div>
    </footer>
  </body>
</html>

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>API Rate Limiting | Aura Video Studio </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="API Rate Limiting | Aura Video Studio ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Coffee285/aura-video-studio/blob/main/docs/api/rate-limits.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="Aura Video Studio">
            Aura Video Studio
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="api-rate-limiting">API Rate Limiting</h1>

<p>Aura Video Studio implements production-grade rate limiting to protect against abuse and accidental denial-of-service scenarios. Rate limits are enforced per IP address with different limits for different endpoints based on their resource intensity.</p>
<h2 id="overview">Overview</h2>
<p><strong>Rate Limiting Library:</strong> AspNetCoreRateLimit v5.0.0</p>
<p><strong>Enforcement Level:</strong> Per IP address (can be changed to per client ID or per user in future)</p>
<p><strong>Response:</strong> HTTP 429 Too Many Requests when limit exceeded</p>
<h2 id="rate-limit-policies">Rate Limit Policies</h2>
<h3 id="endpoint-specific-limits">Endpoint-Specific Limits</h3>
<table>
<thead>
<tr>
<th>Endpoint Pattern</th>
<th>Limit</th>
<th>Window</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>POST /api/jobs</code></td>
<td>10 requests</td>
<td>1 minute</td>
<td>Resource-intensive video rendering jobs</td>
</tr>
<tr>
<td><code>POST /api/quick/demo</code></td>
<td>5 requests</td>
<td>1 minute</td>
<td>Quick demo creation (heavy resource use)</td>
</tr>
<tr>
<td><code>POST /api/script</code></td>
<td>20 requests</td>
<td>1 minute</td>
<td>Script generation (LLM API calls)</td>
</tr>
<tr>
<td><code>*</code> (catch-all)</td>
<td>100 requests</td>
<td>1 minute</td>
<td>General API endpoints</td>
</tr>
</tbody>
</table>
<h3 id="whitelisted-endpoints">Whitelisted Endpoints</h3>
<p>The following endpoints are <strong>exempt</strong> from rate limiting:</p>
<ul>
<li><code>GET /health/*</code> - Health check endpoints (liveness and readiness probes)</li>
<li><code>GET /healthz</code> - Legacy health check endpoint</li>
<li><code>GET /api/health/*</code> - API health check endpoints</li>
</ul>
<p><strong>Reason:</strong> Monitoring systems need to check health frequently without being blocked.</p>
<h2 id="rate-limit-headers">Rate Limit Headers</h2>
<p>Every API response includes rate limit information in headers:</p>
<pre><code class="lang-http">HTTP/1.1 200 OK
X-RateLimit-Limit: 10
X-RateLimit-Remaining: 7
X-RateLimit-Reset: 1698451260
</code></pre>
<p><strong>Headers:</strong></p>
<ul>
<li><code>X-RateLimit-Limit</code> - Maximum requests allowed in the window</li>
<li><code>X-RateLimit-Remaining</code> - Requests remaining in current window</li>
<li><code>X-RateLimit-Reset</code> - Unix timestamp when the limit resets</li>
</ul>
<h2 id="rate-limit-exceeded-response">Rate Limit Exceeded Response</h2>
<p>When you exceed the rate limit, the API returns:</p>
<p><strong>Status Code:</strong> <code>429 Too Many Requests</code></p>
<p><strong>Response Body:</strong></p>
<pre><code class="lang-json">{
  &quot;type&quot;: &quot;https://github.com/Coffee285/aura-video-studio/blob/main/docs/errors/README.md#E429&quot;,
  &quot;title&quot;: &quot;Rate Limit Exceeded&quot;,
  &quot;status&quot;: 429,
  &quot;detail&quot;: &quot;Too many requests. Please retry after the specified time.&quot;
}
</code></pre>
<p><strong>Additional Headers:</strong></p>
<pre><code class="lang-http">HTTP/1.1 429 Too Many Requests
Retry-After: 42
X-RateLimit-Limit: 10
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1698451260
</code></pre>
<p><strong>Retry-After header:</strong> Number of seconds to wait before retrying</p>
<h2 id="configuration">Configuration</h2>
<p>Rate limits are configured in <code>appsettings.json</code>:</p>
<pre><code class="lang-json">{
  &quot;IpRateLimiting&quot;: {
    &quot;EnableEndpointRateLimiting&quot;: true,
    &quot;StackBlockedRequests&quot;: false,
    &quot;HttpStatusCode&quot;: 429,
    &quot;RealIpHeader&quot;: &quot;X-Real-IP&quot;,
    &quot;QuotaExceededResponse&quot;: {
      &quot;Content&quot;: &quot;{\&quot;type\&quot;:\&quot;https://github.com/Coffee285/aura-video-studio/blob/main/docs/errors/README.md#E429\&quot;,\&quot;title\&quot;:\&quot;Rate Limit Exceeded\&quot;,\&quot;status\&quot;:429,\&quot;detail\&quot;:\&quot;Too many requests. Please retry after the specified time.\&quot;}&quot;,
      &quot;ContentType&quot;: &quot;application/json&quot;
    },
    &quot;IpWhitelist&quot;: [],
    &quot;EndpointWhitelist&quot;: [
      &quot;get:/health/*&quot;,
      &quot;get:/healthz&quot;,
      &quot;get:/api/health/*&quot;
    ],
    &quot;GeneralRules&quot;: [
      {
        &quot;Endpoint&quot;: &quot;POST:/api/jobs&quot;,
        &quot;Period&quot;: &quot;1m&quot;,
        &quot;Limit&quot;: 10
      },
      {
        &quot;Endpoint&quot;: &quot;POST:/api/quick/demo&quot;,
        &quot;Period&quot;: &quot;1m&quot;,
        &quot;Limit&quot;: 5
      },
      {
        &quot;Endpoint&quot;: &quot;POST:/api/script&quot;,
        &quot;Period&quot;: &quot;1m&quot;,
        &quot;Limit&quot;: 20
      },
      {
        &quot;Endpoint&quot;: &quot;*&quot;,
        &quot;Period&quot;: &quot;1m&quot;,
        &quot;Limit&quot;: 100
      }
    ]
  }
}
</code></pre>
<h3 id="configuration-options">Configuration Options</h3>
<p><strong>EnableEndpointRateLimiting</strong> (boolean)</p>
<ul>
<li>Enables different rate limits per endpoint</li>
<li>Set to <code>true</code> for production</li>
</ul>
<p><strong>StackBlockedRequests</strong> (boolean)</p>
<ul>
<li>Whether to queue blocked requests</li>
<li>Set to <code>false</code> - rejected requests don't consume quota</li>
</ul>
<p><strong>HttpStatusCode</strong> (integer)</p>
<ul>
<li>HTTP status code for rate-limited requests</li>
<li>Standard: <code>429 Too Many Requests</code></li>
</ul>
<p><strong>RealIpHeader</strong> (string)</p>
<ul>
<li>Header containing the real client IP (when behind a proxy)</li>
<li>Common values: <code>X-Real-IP</code>, <code>X-Forwarded-For</code></li>
</ul>
<p><strong>IpWhitelist</strong> (array)</p>
<ul>
<li>IP addresses exempt from rate limiting</li>
<li>Example: <code>[&quot;127.0.0.1&quot;, &quot;10.0.0.0/8&quot;]</code></li>
<li>Empty by default</li>
</ul>
<p><strong>EndpointWhitelist</strong> (array)</p>
<ul>
<li>Endpoint patterns exempt from rate limiting</li>
<li>Format: <code>METHOD:/path/pattern</code></li>
<li>Wildcards supported: <code>/health/*</code></li>
</ul>
<p><strong>GeneralRules</strong> (array)</p>
<ul>
<li>Rate limit rules per endpoint</li>
<li>Most specific match takes precedence</li>
<li>Catch-all <code>*</code> rule for unmatched endpoints</li>
</ul>
<h2 id="client-best-practices">Client Best Practices</h2>
<h3 id="1-monitor-rate-limit-headers">1. Monitor Rate Limit Headers</h3>
<p>Always check <code>X-RateLimit-Remaining</code> to avoid hitting limits:</p>
<pre><code class="lang-javascript">const response = await fetch('/api/jobs', {
  method: 'POST',
  body: JSON.stringify(jobData)
});

const remaining = response.headers.get('X-RateLimit-Remaining');
if (remaining &lt; 2) {
  console.warn('Approaching rate limit. Slow down requests.');
}
</code></pre>
<h3 id="2-handle-429-responses-gracefully">2. Handle 429 Responses Gracefully</h3>
<p>Implement exponential backoff when rate-limited:</p>
<pre><code class="lang-javascript">async function createJobWithRetry(jobData, maxRetries = 3) {
  for (let i = 0; i &lt; maxRetries; i++) {
    const response = await fetch('/api/jobs', {
      method: 'POST',
      body: JSON.stringify(jobData)
    });

    if (response.status === 429) {
      const retryAfter = response.headers.get('Retry-After');
      const waitTime = retryAfter ? parseInt(retryAfter) * 1000 : Math.pow(2, i) * 1000;
      
      console.log(`Rate limited. Retrying after ${waitTime}ms`);
      await new Promise(resolve =&gt; setTimeout(resolve, waitTime));
      continue;
    }

    return response;
  }

  throw new Error('Max retries exceeded');
}
</code></pre>
<h3 id="3-respect-retry-after-header">3. Respect Retry-After Header</h3>
<p>When rate-limited, wait for the duration specified in <code>Retry-After</code>:</p>
<pre><code class="lang-javascript">if (response.status === 429) {
  const retryAfterSeconds = response.headers.get('Retry-After');
  await new Promise(resolve =&gt; 
    setTimeout(resolve, retryAfterSeconds * 1000)
  );
  // Retry request
}
</code></pre>
<h3 id="4-batch-requests-when-possible">4. Batch Requests When Possible</h3>
<p>Instead of making many individual requests, batch operations:</p>
<pre><code class="lang-javascript">// ❌ Bad: 10 separate requests
for (const script of scripts) {
  await fetch('/api/script', { method: 'POST', body: script });
}

// ✅ Good: 1 batch request (if API supports it)
await fetch('/api/scripts/batch', {
  method: 'POST',
  body: JSON.stringify({ scripts })
});
</code></pre>
<h3 id="5-use-polling-with-backoff">5. Use Polling with Backoff</h3>
<p>When polling for job status, use exponential backoff:</p>
<pre><code class="lang-javascript">async function pollJobStatus(jobId) {
  let delay = 1000; // Start with 1 second
  const maxDelay = 30000; // Max 30 seconds

  while (true) {
    const response = await fetch(`/api/jobs/${jobId}`);
    const job = await response.json();

    if (job.status === 'done' || job.status === 'failed') {
      return job;
    }

    await new Promise(resolve =&gt; setTimeout(resolve, delay));
    delay = Math.min(delay * 1.5, maxDelay); // Exponential backoff
  }
}
</code></pre>
<h2 id="requesting-rate-limit-increases">Requesting Rate Limit Increases</h2>
<p>If you consistently hit rate limits for legitimate use cases:</p>
<ol>
<li><strong>Review your implementation</strong> - Ensure you're following best practices above</li>
<li><strong>Identify your use case</strong> - Document why you need higher limits</li>
<li><strong>Contact support</strong> - Request a rate limit increase with justification</li>
</ol>
<p><strong>Self-hosted deployments:</strong> You can modify rate limits in <code>appsettings.json</code></p>
<h2 id="monitoring-rate-limits">Monitoring Rate Limits</h2>
<h3 id="application-logs">Application Logs</h3>
<p>Rate limit violations are logged:</p>
<pre><code class="lang-log">[12:34:56 WRN] Rate limit exceeded for client 192.168.1.100 on path /api/jobs. Count: 11/10
</code></pre>
<h3 id="metrics">Metrics</h3>
<p>Track rate limit metrics:</p>
<ul>
<li>Number of 429 responses per endpoint</li>
<li>Clients hitting rate limits frequently</li>
<li>Rate limit efficiency (blocked vs allowed requests)</li>
</ul>
<h3 id="alerts">Alerts</h3>
<p>Set up alerts for:</p>
<ul>
<li>Spike in 429 responses (possible attack or bug)</li>
<li>Same IP hitting rate limits repeatedly</li>
<li>Rate limit rules that are never triggered (too lenient)</li>
</ul>
<h2 id="security-considerations">Security Considerations</h2>
<h3 id="ddos-protection">DDoS Protection</h3>
<p>Rate limiting helps protect against:</p>
<ul>
<li><strong>Application-layer DDoS</strong> - Overwhelming the server with requests</li>
<li><strong>Resource exhaustion</strong> - Expensive operations (video rendering, AI generation)</li>
<li><strong>API abuse</strong> - Scraping, credential stuffing, brute force</li>
</ul>
<h3 id="additional-protection-layers">Additional Protection Layers</h3>
<p>Rate limiting is one layer. Also implement:</p>
<ul>
<li><strong>Firewall rules</strong> - Block known malicious IPs at network level</li>
<li><strong>CDN/WAF</strong> - Use CloudFlare, AWS WAF, or similar for additional protection</li>
<li><strong>Authentication</strong> - Require API keys for sensitive endpoints</li>
<li><strong>Input validation</strong> - Prevent injection attacks</li>
<li><strong>Request size limits</strong> - Limit payload size to prevent memory exhaustion</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="getting-429-errors-for-health-checks">&quot;Getting 429 errors for health checks&quot;</h3>
<p><strong>Problem:</strong> Monitoring system is rate-limited</p>
<p><strong>Solution:</strong> Health check endpoints (<code>/health/*</code>, <code>/healthz</code>) are whitelisted. Ensure you're using the correct endpoint path.</p>
<h3 id="rate-limit-resets-at-unexpected-times">&quot;Rate limit resets at unexpected times&quot;</h3>
<p><strong>Problem:</strong> Rate limit window doesn't align with clock time</p>
<p><strong>Solution:</strong> Rate limits use sliding windows, not fixed time periods. The window starts from your first request and runs for the specified period (e.g., 1 minute).</p>
<h3 id="different-clients-getting-same-rate-limit">&quot;Different clients getting same rate limit&quot;</h3>
<p><strong>Problem:</strong> Multiple clients behind same NAT/proxy share rate limit</p>
<p><strong>Solution:</strong></p>
<ol>
<li>Configure proxy to forward client IP in <code>X-Real-IP</code> or <code>X-Forwarded-For</code> header</li>
<li>Update <code>RealIpHeader</code> in configuration</li>
<li>For internal apps, whitelist proxy IP</li>
</ol>
<h3 id="need-temporary-rate-limit-increase">&quot;Need temporary rate limit increase&quot;</h3>
<p><strong>Problem:</strong> One-time bulk operation needs more quota</p>
<p><strong>Solution:</strong></p>
<ol>
<li><strong>Self-hosted:</strong> Temporarily adjust limits in <code>appsettings.json</code> and restart</li>
<li><strong>Cloud:</strong> Whitelist your IP in <code>IpWhitelist</code> configuration</li>
<li><strong>Best practice:</strong> Batch operations and spread over time</li>
</ol>
<h2 id="rate-limiting-behavior">Rate Limiting Behavior</h2>
<h3 id="sliding-window">Sliding Window</h3>
<p>Rate limits use a <strong>sliding window</strong> algorithm:</p>
<pre><code>Example: 10 requests per minute

Time:    0s -------- 30s -------- 60s -------- 90s
Requests: 5           5            -            -

At 60s: Last minute had 10 requests (full quota used)
At 90s: Last minute had 5 requests (quota partially reset)
</code></pre>
<p><strong>Benefit:</strong> Prevents burst at window boundaries</p>
<h3 id="request-stacking">Request Stacking</h3>
<p><code>StackBlockedRequests: false</code> means:</p>
<ul>
<li>Rejected requests (429) don't count toward quota</li>
<li>You can retry immediately after reset without penalty</li>
</ul>
<h3 id="endpoint-matching">Endpoint Matching</h3>
<p>Most specific rule wins:</p>
<pre><code class="lang-json">&quot;GeneralRules&quot;: [
  { &quot;Endpoint&quot;: &quot;POST:/api/jobs&quot;, &quot;Limit&quot;: 10 },
  { &quot;Endpoint&quot;: &quot;POST:/api/*&quot;, &quot;Limit&quot;: 50 },
  { &quot;Endpoint&quot;: &quot;*&quot;, &quot;Limit&quot;: 100 }
]
</code></pre>
<p>Request to <code>POST /api/jobs</code> → Uses 10/min limit (most specific)
Request to <code>POST /api/script</code> → Uses 50/min limit (matches pattern)
Request to <code>GET /api/health</code> → Uses 100/min limit (catch-all)</p>
<h2 id="future-enhancements">Future Enhancements</h2>
<p>Planned improvements:</p>
<ul>
<li><strong>Per-user rate limiting</strong> - Different limits for authenticated users</li>
<li><strong>Tiered rate limits</strong> - Premium users get higher limits</li>
<li><strong>Dynamic rate limiting</strong> - Adjust based on server load</li>
<li><strong>Rate limit quotas</strong> - Daily/monthly quotas in addition to per-minute</li>
<li><strong>Burst allowance</strong> - Allow short bursts above limit</li>
</ul>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="health.html">Health Check Endpoints</a> - API health monitoring</li>
<li><a href="API_CONTRACT_V1.html">API Contract</a> - Full API specification</li>
<li><a href="errors.html">Error Handling</a> - Error response formats</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Coffee285/aura-video-studio/blob/main/docs/api/rate-limits.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © 2025 Aura Video Studio. Documentation built with DocFX.
        </div>
      </div>
    </footer>
  </body>
</html>

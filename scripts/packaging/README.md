# Packaging Scripts

This directory contains scripts for building the portable distribution of Aura Video Studio.

## Distribution Policy

**Aura Video Studio follows a portable-only distribution model.**

- ✅ **Portable ZIP** - Self-contained, no-install distribution (only supported format)
- ❌ **MSIX/APPX packages** - Not supported (removed)
- ❌ **Traditional installers (EXE/Inno Setup)** - Not supported (removed)

This ensures maximum compatibility and flexibility for users without requiring system-level installation or administrator privileges.

## Overview

Aura Video Studio is distributed as a **Portable ZIP** - a no-install archive that works out of the box. Simply extract and run!

## Quick Start

### Using the Make Portable ZIP Script (Recommended)

```powershell
.\scripts\packaging\make_portable_zip.ps1
```

This is the official packaging script that creates a complete portable ZIP distribution with:
- Self-contained API with embedded Web UI
- FFmpeg binaries (if available)
- Configuration files and documentation
- Health check launcher script (start_portable.cmd)
- SHA-256 checksums
- Software Bill of Materials (SBOM)
- Third-party license attributions

Output: `artifacts/windows/portable/AuraVideoStudio_Portable_x64.zip`

### Using the Simple Build Script

```powershell
.\scripts\packaging\build-portable.ps1
```

This script will:
1. Build all .NET projects
2. Build the React web UI
3. Publish the API as self-contained
4. Copy the web UI to wwwroot
5. Create a portable ZIP with everything included

### Using the Legacy Build Script

```powershell
.\scripts\packaging\build-all.ps1
```

This maintains compatibility with the previous build process but only builds the portable distribution.

## Prerequisites

### Required
- **.NET 8 SDK** - Required for building C# projects
  - Download from: https://dotnet.microsoft.com/download/dotnet/8.0
- **Node.js 20.x or later** - Required for building the web UI (Aura.Web)
  - Download from: https://nodejs.org/
  - Or install via chocolatey: `choco install nodejs-lts`
  - Verify installation: `npm --version`
- **PowerShell** - Included with Windows

### Optional
- **FFmpeg binaries** - For video processing (can be downloaded separately)

## Building Portable Distribution

The portable distribution is a self-contained package that requires no installation.

### Automated Build

```powershell
# Using the official packaging script (recommended)
.\scripts\packaging\make_portable_zip.ps1

# Output: artifacts/windows/portable/AuraVideoStudio_Portable_x64.zip

# Using the simple script
.\scripts\packaging\build-portable.ps1

# Output: artifacts/portable/AuraVideoStudio_Portable_x64.zip
```

### Manual Build Steps

If you need to build manually:

```powershell
# 1. Build .NET projects
dotnet build Aura.Core/Aura.Core.csproj -c Release
dotnet build Aura.Providers/Aura.Providers.csproj -c Release
dotnet build Aura.Api/Aura.Api.csproj -c Release

# 2. Build Web UI
cd Aura.Web
npm install
npm run build
cd ..

# 3. Publish API as self-contained
dotnet publish Aura.Api/Aura.Api.csproj `
    -c Release `
    -r win-x64 `
    --self-contained `
    -o artifacts/portable/build/Api

# 4. Copy Web UI to wwwroot (CRITICAL!)
mkdir artifacts/portable/build/Api/wwwroot
xcopy Aura.Web\dist artifacts\portable\build\Api\wwwroot /E /I /Y

# 5. Copy additional files
xcopy scripts\ffmpeg\*.exe artifacts\portable\build\ffmpeg\ /Y
copy appsettings.json artifacts\portable\build\
copy PORTABLE.md artifacts\portable\build\README.md
copy LICENSE artifacts\portable\build\

# 6. Create launcher script
# (See build-portable.ps1 for the launcher script content)

# 7. Create ZIP
Compress-Archive -Path artifacts/portable/build/* `
    -DestinationPath artifacts/portable/AuraVideoStudio_Portable_x64.zip
```

## Generating SHA-256 Checksums

```powershell
# Checksum is automatically generated by build-portable.ps1
# Or generate manually:
Get-FileHash -Path artifacts/portable/AuraVideoStudio_Portable_x64.zip -Algorithm SHA256
```

## Directory Structure After Build

### make_portable_zip.ps1 Output Structure

```
artifacts/windows/portable/
├── AuraVideoStudio_Portable_x64.zip
├── AuraVideoStudio_Portable_x64.zip.sha256
└── build/
    ├── api/
    │   ├── Aura.Api.exe          (Main executable)
    │   ├── wwwroot/               (Web UI files - CRITICAL!)
    │   │   ├── index.html
    │   │   └── assets/
    │   └── (DLLs and dependencies)
    ├── web/                       (Reference copy)
    │   ├── index.html
    │   └── assets/
    ├── ffmpeg/
    │   ├── ffmpeg.exe
    │   └── ffprobe.exe
    ├── config/
    │   └── appsettings.json
    ├── assets/                    (If available)
    │   └── (CC0 packs, LUTs, fonts)
    ├── start_portable.cmd         (Launcher with /healthz check)
    ├── checksums.txt              (SHA-256 for all files)
    ├── sbom.json                  (Software Bill of Materials)
    ├── attributions.txt           (Third-party licenses)
    ├── README.md                  (User documentation)
    └── LICENSE
```

### build-portable.ps1 Output Structure

```
artifacts/
└── portable/
    ├── build/
    │   ├── Api/
    │   │   ├── Aura.Api.exe          (Main executable)
    │   │   ├── wwwroot/               (Web UI files - CRITICAL!)
    │   │   │   ├── index.html
    │   │   │   └── assets/
    │   │   └── (DLLs and dependencies)
    │   ├── ffmpeg/
    │   │   ├── ffmpeg.exe
    │   │   └── ffprobe.exe
    │   ├── Launch.bat                 (Launcher script)
    │   ├── README.md
    │   ├── appsettings.json
    │   └── LICENSE
    ├── AuraVideoStudio_Portable_x64.zip
    └── checksum.txt
```

## Important Notes

### Critical: wwwroot Directory

The `wwwroot` directory **must** be placed inside the `Api` folder for the web UI to work:
- ✅ Correct: `Api/wwwroot/index.html`
- ❌ Wrong: `wwwroot/index.html` (at root level)
- ❌ Wrong: `Web/index.html` (separate folder)

The API looks for static files in `Directory.GetCurrentDirectory() + "/wwwroot"`, which means it must be in the same directory as `Aura.Api.exe`.

### FFmpeg Binaries

FFmpeg binaries should be placed in `scripts/ffmpeg/` before building, or users can download them separately. The application will look for FFmpeg in:
1. The `ffmpeg` subfolder
2. System PATH
3. The current directory

### Testing the Build

Before distributing, always test the portable build:

```powershell
# Extract the ZIP
Expand-Archive artifacts/windows/portable/AuraVideoStudio_Portable_x64.zip -DestinationPath test-extract

# Run the application
cd test-extract
.\start_portable.cmd

# The launcher will:
# - Start the API
# - Wait for /healthz to return healthy
# - Open your browser to http://127.0.0.1:5005
# - Display status messages

# Verify:
# - API starts on http://127.0.0.1:5005
# - Browser opens automatically
# - Web UI loads correctly (no 404 errors)
# - All features work as expected
```
